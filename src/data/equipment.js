// Equipment definitions — Defense of Rhaud
// Items, loot tables, and shop inventory

export const EQUIPMENT_SLOTS = [
  'helmet', 'shoulderpads', 'gloves', 'breastplate',
  'greaves', 'boots', 'belt', 'rightHand', 'leftHand',
];

// ~30 items across all 9 slot types
// Tiers: Common (1-3 stat pts, 20-50g), Uncommon (3-6 pts, 60-120g), Rare (6-10 pts, 150-250g)
export const EQUIPMENT = {
  // ──── Helmets ────
  leather_cap: {
    id: 'leather_cap',
    name: 'Leather Cap',
    slot: 'helmet',
    stats: { atk: 0, def: 1, spd: 0, hp: 5, mp: 0 },
    classBonus: {},
    desc: 'A simple leather cap. Better than nothing.',
    rarity: 'Common',
    buyPrice: 25,
    sellPrice: 12,
  },
  iron_helm: {
    id: 'iron_helm',
    name: 'Iron Helm',
    slot: 'helmet',
    stats: { atk: 0, def: 3, spd: 0, hp: 5, mp: 0 },
    classBonus: { Warrior: { def: 2 }, Commander: { def: 1 } },
    desc: 'A sturdy iron helmet forged at the frontier.',
    rarity: 'Uncommon',
    buyPrice: 80,
    sellPrice: 40,
  },
  arcane_circlet: {
    id: 'arcane_circlet',
    name: 'Arcane Circlet',
    slot: 'helmet',
    stats: { atk: 2, def: 0, spd: 1, hp: 0, mp: 10 },
    classBonus: { Wizard: { atk: 2, mp: 5 } },
    desc: 'A thin band of enchanted silver. Hums with energy.',
    rarity: 'Uncommon',
    buyPrice: 90,
    sellPrice: 45,
  },
  warden_helm: {
    id: 'warden_helm',
    name: "Warden's Helm",
    slot: 'helmet',
    stats: { atk: 1, def: 4, spd: 0, hp: 10, mp: 0 },
    classBonus: { Commander: { def: 2, hp: 5 } },
    desc: 'Worn by officers of the Eastern Watch. Inspires courage.',
    rarity: 'Rare',
    buyPrice: 180,
    sellPrice: 90,
  },

  // ──── Shoulderpads ────
  hide_pauldrons: {
    id: 'hide_pauldrons',
    name: 'Hide Pauldrons',
    slot: 'shoulderpads',
    stats: { atk: 0, def: 2, spd: 0, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'Thick animal hide shaped over the shoulders.',
    rarity: 'Common',
    buyPrice: 30,
    sellPrice: 15,
  },
  chainmail_shoulders: {
    id: 'chainmail_shoulders',
    name: 'Chainmail Shoulders',
    slot: 'shoulderpads',
    stats: { atk: 0, def: 3, spd: -1, hp: 5, mp: 0 },
    classBonus: { Warrior: { def: 2 } },
    desc: 'Interlocking steel rings. Heavy but reliable.',
    rarity: 'Uncommon',
    buyPrice: 75,
    sellPrice: 37,
  },
  blessed_mantle: {
    id: 'blessed_mantle',
    name: 'Blessed Mantle',
    slot: 'shoulderpads',
    stats: { atk: 1, def: 1, spd: 0, hp: 5, mp: 8 },
    classBonus: { Priest: { hp: 5, mp: 5 } },
    desc: 'A cloth mantle imbued with protective prayers.',
    rarity: 'Rare',
    buyPrice: 160,
    sellPrice: 80,
  },

  // ──── Gloves ────
  cloth_wraps: {
    id: 'cloth_wraps',
    name: 'Cloth Wraps',
    slot: 'gloves',
    stats: { atk: 1, def: 0, spd: 1, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'Simple hand wraps. Keep a firm grip.',
    rarity: 'Common',
    buyPrice: 20,
    sellPrice: 10,
  },
  gauntlets_of_might: {
    id: 'gauntlets_of_might',
    name: 'Gauntlets of Might',
    slot: 'gloves',
    stats: { atk: 3, def: 1, spd: 0, hp: 0, mp: 0 },
    classBonus: { Warrior: { atk: 2 }, Commander: { atk: 1 } },
    desc: 'Reinforced gauntlets that add force to every blow.',
    rarity: 'Uncommon',
    buyPrice: 85,
    sellPrice: 42,
  },
  ranger_bracers: {
    id: 'ranger_bracers',
    name: 'Ranger Bracers',
    slot: 'gloves',
    stats: { atk: 2, def: 0, spd: 2, hp: 0, mp: 0 },
    classBonus: { Ranger: { spd: 2, atk: 1 } },
    desc: 'Lightweight leather bracers for quick draws.',
    rarity: 'Uncommon',
    buyPrice: 70,
    sellPrice: 35,
  },

  // ──── Breastplates ────
  padded_vest: {
    id: 'padded_vest',
    name: 'Padded Vest',
    slot: 'breastplate',
    stats: { atk: 0, def: 2, spd: 0, hp: 5, mp: 0 },
    classBonus: {},
    desc: 'A quilted vest stuffed with wool. Absorbs light blows.',
    rarity: 'Common',
    buyPrice: 35,
    sellPrice: 17,
  },
  chainmail_hauberk: {
    id: 'chainmail_hauberk',
    name: 'Chainmail Hauberk',
    slot: 'breastplate',
    stats: { atk: 0, def: 4, spd: -1, hp: 10, mp: 0 },
    classBonus: { Warrior: { def: 2, hp: 5 }, Commander: { def: 1, hp: 5 } },
    desc: 'A coat of interlocking steel rings. Standard frontier issue.',
    rarity: 'Uncommon',
    buyPrice: 100,
    sellPrice: 50,
  },
  runed_robe: {
    id: 'runed_robe',
    name: 'Runed Robe',
    slot: 'breastplate',
    stats: { atk: 3, def: 1, spd: 0, hp: 0, mp: 12 },
    classBonus: { Wizard: { atk: 2, mp: 5 } },
    desc: 'Robes inscribed with arcane formulas. Amplifies magic.',
    rarity: 'Rare',
    buyPrice: 200,
    sellPrice: 100,
  },
  commander_plate: {
    id: 'commander_plate',
    name: "Commander's Plate",
    slot: 'breastplate',
    stats: { atk: 1, def: 5, spd: 0, hp: 15, mp: 0 },
    classBonus: { Commander: { def: 3, hp: 5 } },
    desc: 'Heavy plate armor bearing the crest of the Eastern Watch.',
    rarity: 'Rare',
    buyPrice: 250,
    sellPrice: 125,
  },

  // ──── Greaves ────
  leather_greaves: {
    id: 'leather_greaves',
    name: 'Leather Greaves',
    slot: 'greaves',
    stats: { atk: 0, def: 1, spd: 1, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'Shin guards of boiled leather.',
    rarity: 'Common',
    buyPrice: 25,
    sellPrice: 12,
  },
  iron_greaves: {
    id: 'iron_greaves',
    name: 'Iron Greaves',
    slot: 'greaves',
    stats: { atk: 0, def: 3, spd: 0, hp: 5, mp: 0 },
    classBonus: { Warrior: { def: 1 } },
    desc: 'Solid iron leg guards. Slows you down but protects well.',
    rarity: 'Uncommon',
    buyPrice: 65,
    sellPrice: 32,
  },

  // ──── Boots ────
  worn_boots: {
    id: 'worn_boots',
    name: 'Worn Boots',
    slot: 'boots',
    stats: { atk: 0, def: 0, spd: 2, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'Battered but functional. Keep your feet moving.',
    rarity: 'Common',
    buyPrice: 20,
    sellPrice: 10,
  },
  scout_boots: {
    id: 'scout_boots',
    name: 'Scout Boots',
    slot: 'boots',
    stats: { atk: 0, def: 0, spd: 3, hp: 0, mp: 0 },
    classBonus: { Ranger: { spd: 2 } },
    desc: 'Soft-soled boots for silent movement through the wilds.',
    rarity: 'Uncommon',
    buyPrice: 60,
    sellPrice: 30,
  },
  ironshod_boots: {
    id: 'ironshod_boots',
    name: 'Ironshod Boots',
    slot: 'boots',
    stats: { atk: 0, def: 2, spd: 1, hp: 5, mp: 0 },
    classBonus: { Commander: { def: 1 }, Warrior: { def: 1 } },
    desc: 'Steel-tipped boots. Good for kicking down doors.',
    rarity: 'Uncommon',
    buyPrice: 70,
    sellPrice: 35,
  },

  // ──── Belts ────
  rope_belt: {
    id: 'rope_belt',
    name: 'Rope Belt',
    slot: 'belt',
    stats: { atk: 0, def: 0, spd: 0, hp: 5, mp: 0 },
    classBonus: {},
    desc: 'A simple rope. Holds things together.',
    rarity: 'Common',
    buyPrice: 20,
    sellPrice: 10,
  },
  war_belt: {
    id: 'war_belt',
    name: 'War Belt',
    slot: 'belt',
    stats: { atk: 1, def: 1, spd: 0, hp: 5, mp: 0 },
    classBonus: { Warrior: { atk: 1, hp: 5 } },
    desc: 'A wide leather belt with weapon loops and pouches.',
    rarity: 'Uncommon',
    buyPrice: 65,
    sellPrice: 32,
  },
  sash_of_focus: {
    id: 'sash_of_focus',
    name: 'Sash of Focus',
    slot: 'belt',
    stats: { atk: 1, def: 0, spd: 1, hp: 0, mp: 8 },
    classBonus: { Wizard: { mp: 5 }, Priest: { mp: 5 } },
    desc: 'A silk sash that sharpens the mind.',
    rarity: 'Uncommon',
    buyPrice: 75,
    sellPrice: 37,
  },

  // ──── Right Hand (weapons) ────
  rusty_sword: {
    id: 'rusty_sword',
    name: 'Rusty Sword',
    slot: 'rightHand',
    stats: { atk: 2, def: 0, spd: 0, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'A notched blade, but it still cuts.',
    rarity: 'Common',
    buyPrice: 30,
    sellPrice: 15,
  },
  frontier_blade: {
    id: 'frontier_blade',
    name: 'Frontier Blade',
    slot: 'rightHand',
    stats: { atk: 4, def: 0, spd: 1, hp: 0, mp: 0 },
    classBonus: { Commander: { atk: 2 }, Warrior: { atk: 1 } },
    desc: 'A well-forged sword from the eastern armory.',
    rarity: 'Uncommon',
    buyPrice: 90,
    sellPrice: 45,
  },
  hunter_bow: {
    id: 'hunter_bow',
    name: "Hunter's Bow",
    slot: 'rightHand',
    stats: { atk: 3, def: 0, spd: 2, hp: 0, mp: 0 },
    classBonus: { Ranger: { atk: 2, spd: 1 } },
    desc: 'A recurve bow made from yew. Fast and accurate.',
    rarity: 'Uncommon',
    buyPrice: 85,
    sellPrice: 42,
  },
  staff_of_embers: {
    id: 'staff_of_embers',
    name: 'Staff of Embers',
    slot: 'rightHand',
    stats: { atk: 4, def: 0, spd: 0, hp: 0, mp: 8 },
    classBonus: { Wizard: { atk: 3 } },
    desc: 'A gnarled staff that smolders at the tip.',
    rarity: 'Rare',
    buyPrice: 170,
    sellPrice: 85,
  },
  holy_mace: {
    id: 'holy_mace',
    name: 'Holy Mace',
    slot: 'rightHand',
    stats: { atk: 3, def: 1, spd: 0, hp: 0, mp: 5 },
    classBonus: { Priest: { atk: 2, mp: 3 } },
    desc: 'A silver mace consecrated by the old light.',
    rarity: 'Uncommon',
    buyPrice: 95,
    sellPrice: 47,
  },
  executioner_axe: {
    id: 'executioner_axe',
    name: "Executioner's Axe",
    slot: 'rightHand',
    stats: { atk: 6, def: 0, spd: -1, hp: 0, mp: 0 },
    classBonus: { Warrior: { atk: 3 } },
    desc: 'A massive two-handed axe. Slow but devastating.',
    rarity: 'Rare',
    buyPrice: 220,
    sellPrice: 110,
  },

  // ──── Left Hand (shields, off-hand) ────
  wooden_buckler: {
    id: 'wooden_buckler',
    name: 'Wooden Buckler',
    slot: 'leftHand',
    stats: { atk: 0, def: 2, spd: 0, hp: 0, mp: 0 },
    classBonus: {},
    desc: 'A small round shield. Blocks glancing blows.',
    rarity: 'Common',
    buyPrice: 25,
    sellPrice: 12,
  },
  iron_shield: {
    id: 'iron_shield',
    name: 'Iron Shield',
    slot: 'leftHand',
    stats: { atk: 0, def: 4, spd: -1, hp: 5, mp: 0 },
    classBonus: { Commander: { def: 2 }, Warrior: { def: 1 } },
    desc: 'A heavy shield that can turn even strong blows.',
    rarity: 'Uncommon',
    buyPrice: 80,
    sellPrice: 40,
  },
  tome_of_wisdom: {
    id: 'tome_of_wisdom',
    name: 'Tome of Wisdom',
    slot: 'leftHand',
    stats: { atk: 1, def: 0, spd: 0, hp: 0, mp: 10 },
    classBonus: { Priest: { mp: 5 }, Wizard: { atk: 1, mp: 3 } },
    desc: 'A weathered book of ancient knowledge.',
    rarity: 'Uncommon',
    buyPrice: 75,
    sellPrice: 37,
  },
};

// ──── Consumable Items ────
export const CONSUMABLES = {
  health_potion: {
    id: 'health_potion',
    name: 'Health Potion',
    type: 'heal_hp',
    target: 'ally',
    amount: 40,
    desc: 'Restores 40 HP to one ally.',
    rarity: 'Common',
    buyPrice: 20,
    sellPrice: 10,
  },
  greater_health_potion: {
    id: 'greater_health_potion',
    name: 'Greater Health Potion',
    type: 'heal_hp',
    target: 'ally',
    amount: 100,
    desc: 'Restores 100 HP to one ally.',
    rarity: 'Uncommon',
    buyPrice: 50,
    sellPrice: 25,
  },
  mana_potion: {
    id: 'mana_potion',
    name: 'Mana Potion',
    type: 'heal_mp',
    target: 'ally',
    amount: 25,
    desc: 'Restores 25 MP to one ally.',
    rarity: 'Common',
    buyPrice: 30,
    sellPrice: 15,
  },
  antidote: {
    id: 'antidote',
    name: 'Antidote',
    type: 'cleanse',
    target: 'ally',
    amount: 0,
    desc: 'Clears all status effects from one ally.',
    rarity: 'Common',
    buyPrice: 15,
    sellPrice: 7,
  },
};

export const CONSUMABLE_SHOP_INVENTORY = [
  'health_potion', 'greater_health_potion', 'mana_potion', 'antidote',
];

// Lookup helper — checks both EQUIPMENT and CONSUMABLES
export function lookupItem(itemId) {
  if (EQUIPMENT[itemId]) return { item: EQUIPMENT[itemId], category: 'equipment' };
  if (CONSUMABLES[itemId]) return { item: CONSUMABLES[itemId], category: 'consumable' };
  return null;
}

// Loot tables by enemy type — weighted drop chances
// Each entry: { itemId, weight }  (higher weight = more likely)
// null entries = no drop
export const LOOT_TABLES = {
  skeleton: [
    { itemId: null, weight: 50 },
    { itemId: 'cloth_wraps', weight: 10 },
    { itemId: 'leather_greaves', weight: 8 },
    { itemId: 'wooden_buckler', weight: 8 },
    { itemId: 'rope_belt', weight: 7 },
    { itemId: 'rusty_sword', weight: 7 },
    { itemId: 'health_potion', weight: 6 },
    { itemId: 'iron_helm', weight: 4 },
    { itemId: 'iron_greaves', weight: 4 },
    { itemId: 'frontier_blade', weight: 2 },
  ],
  zombie: [
    { itemId: null, weight: 45 },
    { itemId: 'leather_cap', weight: 8 },
    { itemId: 'hide_pauldrons', weight: 8 },
    { itemId: 'padded_vest', weight: 8 },
    { itemId: 'worn_boots', weight: 7 },
    { itemId: 'health_potion', weight: 6 },
    { itemId: 'antidote', weight: 6 },
    { itemId: 'war_belt', weight: 6 },
    { itemId: 'chainmail_shoulders', weight: 5 },
    { itemId: 'chainmail_hauberk', weight: 4 },
    { itemId: 'gauntlets_of_might', weight: 3 },
    { itemId: 'iron_shield', weight: 3 },
    { itemId: 'executioner_axe', weight: 1 },
    { itemId: 'runed_robe', weight: 1 },
    { itemId: 'commander_plate', weight: 1 },
  ],
  wraith: [
    { itemId: null, weight: 35 },
    { itemId: 'arcane_circlet', weight: 15 },
    { itemId: 'tome_of_wisdom', weight: 15 },
    { itemId: 'sash_of_focus', weight: 12 },
    { itemId: 'mana_potion', weight: 8 },
    { itemId: 'runed_robe', weight: 8 },
    { itemId: 'staff_of_embers', weight: 5 },
    { itemId: 'blessed_mantle', weight: 5 },
    { itemId: 'warden_helm', weight: 5 },
  ],
  dark_knight: [
    { itemId: null, weight: 30 },
    { itemId: 'iron_shield', weight: 15 },
    { itemId: 'frontier_blade', weight: 12 },
    { itemId: 'iron_greaves', weight: 10 },
    { itemId: 'chainmail_hauberk', weight: 8 },
    { itemId: 'commander_plate', weight: 8 },
    { itemId: 'greater_health_potion', weight: 7 },
    { itemId: 'gauntlets_of_might', weight: 7 },
    { itemId: 'executioner_axe', weight: 5 },
    { itemId: 'warden_helm', weight: 5 },
  ],
  necromancer: [
    { itemId: null, weight: 30 },
    { itemId: 'staff_of_embers', weight: 15 },
    { itemId: 'runed_robe', weight: 12 },
    { itemId: 'blessed_mantle', weight: 12 },
    { itemId: 'arcane_circlet', weight: 10 },
    { itemId: 'mana_potion', weight: 8 },
    { itemId: 'greater_health_potion', weight: 8 },
    { itemId: 'tome_of_wisdom', weight: 8 },
    { itemId: 'sash_of_focus', weight: 8 },
    { itemId: 'holy_mace', weight: 5 },
  ],
  cursed_archer: [
    { itemId: null, weight: 30 },
    { itemId: 'hunter_bow', weight: 15 },
    { itemId: 'scout_boots', weight: 15 },
    { itemId: 'ranger_bracers', weight: 12 },
    { itemId: 'antidote', weight: 8 },
    { itemId: 'leather_greaves', weight: 8 },
    { itemId: 'cloth_wraps', weight: 8 },
    { itemId: 'war_belt', weight: 7 },
    { itemId: 'ironshod_boots', weight: 5 },
  ],
  atikesh: [
    { itemId: 'commander_plate', weight: 20 },
    { itemId: 'executioner_axe', weight: 20 },
    { itemId: 'staff_of_embers', weight: 20 },
    { itemId: 'warden_helm', weight: 15 },
    { itemId: 'runed_robe', weight: 15 },
    { itemId: 'blessed_mantle', weight: 10 },
  ],

  // ──── Beast loot ────
  plague_rat: [
    { itemId: null, weight: 60 },
    { itemId: 'antidote', weight: 12 },
    { itemId: 'health_potion', weight: 10 },
    { itemId: 'cloth_wraps', weight: 8 },
    { itemId: 'rope_belt', weight: 5 },
    { itemId: 'leather_cap', weight: 5 },
  ],
  blood_bat: [
    { itemId: null, weight: 45 },
    { itemId: 'health_potion', weight: 12 },
    { itemId: 'antidote', weight: 10 },
    { itemId: 'scout_boots', weight: 8 },
    { itemId: 'leather_greaves', weight: 8 },
    { itemId: 'cloth_wraps', weight: 7 },
    { itemId: 'ranger_bracers', weight: 5 },
    { itemId: 'sash_of_focus', weight: 5 },
  ],
  dire_wolf: [
    { itemId: null, weight: 45 },
    { itemId: 'hide_pauldrons', weight: 12 },
    { itemId: 'leather_greaves', weight: 10 },
    { itemId: 'worn_boots', weight: 8 },
    { itemId: 'war_belt', weight: 8 },
    { itemId: 'health_potion', weight: 7 },
    { itemId: 'iron_greaves', weight: 5 },
    { itemId: 'gauntlets_of_might', weight: 5 },
  ],
  fell_spider: [
    { itemId: null, weight: 40 },
    { itemId: 'antidote', weight: 15 },
    { itemId: 'cloth_wraps', weight: 10 },
    { itemId: 'scout_boots', weight: 8 },
    { itemId: 'ranger_bracers', weight: 8 },
    { itemId: 'health_potion', weight: 7 },
    { itemId: 'hunter_bow', weight: 6 },
    { itemId: 'sash_of_focus', weight: 6 },
  ],

  // ──── Demon loot ────
  shadow_fiend: [
    { itemId: null, weight: 30 },
    { itemId: 'arcane_circlet', weight: 12 },
    { itemId: 'tome_of_wisdom', weight: 12 },
    { itemId: 'sash_of_focus', weight: 10 },
    { itemId: 'mana_potion', weight: 10 },
    { itemId: 'runed_robe', weight: 8 },
    { itemId: 'staff_of_embers', weight: 6 },
    { itemId: 'blessed_mantle', weight: 6 },
    { itemId: 'greater_health_potion', weight: 6 },
  ],
  hellhound: [
    { itemId: null, weight: 30 },
    { itemId: 'iron_helm', weight: 12 },
    { itemId: 'chainmail_hauberk', weight: 10 },
    { itemId: 'iron_greaves', weight: 10 },
    { itemId: 'gauntlets_of_might', weight: 8 },
    { itemId: 'greater_health_potion', weight: 8 },
    { itemId: 'frontier_blade', weight: 7 },
    { itemId: 'ironshod_boots', weight: 7 },
    { itemId: 'executioner_axe', weight: 4 },
    { itemId: 'commander_plate', weight: 4 },
  ],

  // ──── Corrupted Nature loot ────
  corrupted_treant: [
    { itemId: null, weight: 25 },
    { itemId: 'commander_plate', weight: 10 },
    { itemId: 'warden_helm', weight: 10 },
    { itemId: 'blessed_mantle', weight: 10 },
    { itemId: 'executioner_axe', weight: 8 },
    { itemId: 'runed_robe', weight: 8 },
    { itemId: 'staff_of_embers', weight: 8 },
    { itemId: 'iron_shield', weight: 7 },
    { itemId: 'greater_health_potion', weight: 7 },
    { itemId: 'chainmail_hauberk', weight: 7 },
  ],
};

// Roll loot for a single enemy kill. Returns itemId or null.
export function rollLoot(enemyType) {
  const table = LOOT_TABLES[enemyType];
  if (!table) return null;

  const totalWeight = table.reduce((s, e) => s + e.weight, 0);
  let roll = Math.random() * totalWeight;

  for (const entry of table) {
    roll -= entry.weight;
    if (roll <= 0) return entry.itemId;
  }
  return null;
}

// Items available at the campfire shop
export const SHOP_INVENTORY = [
  'leather_cap',
  'iron_helm',
  'hide_pauldrons',
  'chainmail_shoulders',
  'cloth_wraps',
  'gauntlets_of_might',
  'ranger_bracers',
  'padded_vest',
  'chainmail_hauberk',
  'leather_greaves',
  'iron_greaves',
  'worn_boots',
  'scout_boots',
  'ironshod_boots',
  'rope_belt',
  'war_belt',
  'sash_of_focus',
  'rusty_sword',
  'frontier_blade',
  'hunter_bow',
  'holy_mace',
  'wooden_buckler',
  'iron_shield',
  'tome_of_wisdom',
  'arcane_circlet',
  'runed_robe',
  'staff_of_embers',
  'executioner_axe',
  'warden_helm',
  'blessed_mantle',
  'commander_plate',
];
